<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
             x:Class="MauiMapOpacityDemo.MainPage"
             Title="MAUI Maps Polygon Bug Repro">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Padding="10" BackgroundColor="#f0f0f0">
            <Label Text="MapElements Clear/Update Bug"
                   FontSize="18"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"/>
            <Label x:Name="StatusLabel"
                   Text="Demonstrates that MapElements changes don't sync to native map"
                   FontSize="11"
                   HorizontalOptions="Center"
                   TextColor="Gray"/>
        </VerticalStackLayout>

        <!-- Map -->
        <maps:Map x:Name="TestMap"
                  Grid.Row="1"
                  MapType="Street"
                  IsShowingUser="False"
                  IsScrollEnabled="True"
                  IsZoomEnabled="True"/>

        <!-- Controls -->
        <VerticalStackLayout Grid.Row="2" Padding="10" Spacing="8" BackgroundColor="#f0f0f0">

            <!-- Bug 1: Clear doesn't remove native polygons -->
            <Label Text="BUG 1: Clear() doesn't remove native polygons"
                   FontSize="11" FontAttributes="Bold" HorizontalOptions="Center"/>
            <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                <Button Text="1. Add 3 Polygons"
                        Clicked="OnAddPolygonsClicked"
                        BackgroundColor="#2196F3"
                        TextColor="White"/>
                <Button Text="2. Clear()"
                        Clicked="OnClearClicked"
                        BackgroundColor="#f44336"
                        TextColor="White"/>
                <Button Text="3. Check Count"
                        Clicked="OnCountClicked"/>
            </HorizontalStackLayout>
            <HorizontalStackLayout Spacing="10" HorizontalOptions="Center" Margin="0,5,0,0">
                <Button Text="Clear (transparent first - FAILS)"
                        Clicked="OnClearWithWorkaroundClicked"
                        BackgroundColor="#607D8B"
                        TextColor="White"/>
            </HorizontalStackLayout>

            <!-- Bug 2: Property updates don't sync to native -->
            <Label Text="BUG 2: Property changes don't update native polygons"
                   FontSize="11" FontAttributes="Bold" HorizontalOptions="Center" Margin="0,10,0,0"/>
            <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                <Button Text="1. Add Polygons"
                        Clicked="OnAddPolygonsClicked"
                        BackgroundColor="#2196F3"
                        TextColor="White"/>
                <Button Text="2. Set Alpha=0"
                        Clicked="OnSetAlphaZeroClicked"
                        BackgroundColor="#ff9800"
                        TextColor="White"/>
                <Button Text="3. Diagnostics"
                        Clicked="OnDiagnosticsClicked"
                        BackgroundColor="#9c27b0"
                        TextColor="White"/>
            </HorizontalStackLayout>

            <Label x:Name="InfoLabel"
                   Text="After Clear: Count=0 but polygons still visible. After Alpha=0: MAUI property is 0 but polygons still visible."
                   FontSize="10"
                   HorizontalOptions="Center"
                   TextColor="DarkSlateGray"/>
        </VerticalStackLayout>

    </Grid>

</ContentPage>
